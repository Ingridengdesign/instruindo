<app-header></app-header>

<div *ngIf="isLoading" class="page-loading">
  <mat-spinner></mat-spinner>
</div>

<main class="perfil-page" *ngIf="!isLoading && professor">
  <div class="container">

    <a routerLink="/search" mat-button class="back-button">
      <mat-icon>arrow_back</mat-icon>
      Voltar para a busca
    </a>

    <div class="perfil-grid">

      <div class="perfil-main">

        <mat-card class="profile-card">
          <img [src]="professor.urlFoto || 'https://material.angular.io/assets/img/examples/shiba2.jpg'"
            alt="Foto de {{professor.nome}}">
          <h2>{{ professor.nome }}</h2>
          <div class="profile-meta">
            <span><mat-icon>star</mat-icon> {{ professor.mediaAvaliacao | number:'1.1-1' }}</span>
            <span *ngFor="let catNome of professor.categorias" class="tag">
              {{ catNome }}
            </span>
          </div>
        </mat-card>

        <mat-card class="content-card">
          <mat-card-title>Sobre</mat-card-title>
          <mat-card-content>
            <p>{{ professor.summary || 'Nenhuma descrição disponível.' }}</p>
          </mat-card-content>
        </mat-card>

        <mat-card class="content-card">
          <mat-card-title>Avaliações dos alunos</mat-card-title>

          <div class="reviews-list">

            <div *ngFor="let avaliacao of professor.avaliacoes" class="review-item">

              <div class="review-avatar">
                <span>{{ getInitials(avaliacao.nomeAluno) }}</span>
              </div>

              <div class="review-content">
                <div class="review-header">
                  <span class="review-name">{{ avaliacao.nomeAluno }}</span>
                </div>
                <div class="review-stars">
                  <mat-icon>star</mat-icon>
                  <span>{{ avaliacao.nota | number:'1.1-1' }}</span>
                </div>
                <p class="review-comment">{{ avaliacao.comentario }}</p>
              </div>
            </div>

            <div *ngIf="!professor.avaliacoes || professor.avaliacoes.length === 0" class="empty-review">
              <mat-icon>rate_review</mat-icon>
              <p>Este professor ainda não recebeu avaliações.</p>
            </div>

          </div>
        </mat-card>

      </div>

      <div class="perfil-sidebar">

        <mat-card class="price-card">
          <div class="price">
            <span>R$ {{ professor.precoPorHora | number:'1.2-2' }}</span> / hora
          </div>
          <button mat-raised-button color="primary" (click)="abrirModalSolicitacao()">
            Solicitar Aula
          </button>
          <button mat-button>Enviar Mensagem</button>
        </mat-card>

        <mat-card class="calendar-card">
          <mat-card-title>Disponibilidade</mat-card-title>
          <mat-card-content>
            <app-calendar *ngIf="!isLoadingAgenda" [dateClass]="dateClass">
            </app-calendar>
          </mat-card-content>
        </mat-card>

      </div>
    </div>
  </div>
</main>

<app-footer></app-footer>
